# Cold Start Chatbot 개발 명세

## 개요
신규 SKU(판매 이력 없는 상품)의 발주량 예측을 위한 AI 챗봇.
유사 상품의 첫 주 판매 데이터를 기반으로 예측값 산출.

## 데이터 소스
- **테이블**: Supabase `after_preprocessing`
- **컬럼**: `sale_dt`, `sku`, `sku_name`, `store_cd`, `sell_qty`
- **데이터**: SKU별 생애주기 첫 30일치

## 처리 플로우

### Step 1: 품목 그룹 추론
- 사용자 입력: "타이백귤 발주량 알려줘"
- LLM에게 질의: 입력된 과일명이 어느 품목 그룹에 속하는지 판단
- 품목 그룹 목록:
  - 딸기, 일반 감귤, 프리미엄 감귤, 오렌지, 레몬/라임/유자, 자몽
  - 포도, 사과, 석류, 토마토, 바나나, 수박, 멜론, 배, 복숭아
  - 키위, 망고, 파인애플, 블루베리, 체리, 자두/살구, 감, 참외
  - 무화과, 아보카도, 용과, 오디, 파파야, 패션후르츠, 두리안, 리치, 모과, 매실, 앵두
- 매칭 실패 시: "None" → 기본 추천 (10개 내외)

### Step 2: PRODUCT_GROUPS에서 키워드 추출
- 품목 그룹명을 key로 PRODUCT_GROUPS dict에서 value(키워드 리스트) 가져오기
- 예: '일반 감귤' → ['귤', '감귤', '썬레드', '만다린']

### Step 3: Supabase에서 유사 상품 검색
- `sku_name` 컬럼에서 키워드로 LIKE 검색 (부분 매칭)
- 예: '감귤' → '하우스감귤(800g/팩)', 'H_Sweet 고당도 감귤' 등

### Step 4: Top 3 유사 상품 선정 (LLM)
- 검색된 상품 목록을 LLM에게 전달
- 입력 상품과 가장 유사한 3개 선정 + 선정 근거 한 줄

### Step 5: 첫 주 통계 계산
- Top 3 상품별로 `after_preprocessing` 테이블에서 조회
- 각 SKU의 `sale_dt` 최소값부터 7일간 데이터 추출
- 통계: 평균(mean), 최소(min), 최대(max), 표준편차(std)

### Step 6: 최종 예측값 산출 (LLM)
- 통계 데이터를 LLM에게 전달
- 신규 상품의 추천 발주량 산출 + 근거 설명

## UI 구현

### 버튼 위치
- 페이지 하단, '임시저장' 버튼 왼쪽에 '신규 SKU 예측' 버튼

### 모달 챗봇 형태
- `@st.dialog` 데코레이터 사용 (Streamlit 1.31+)
- 대화형 인터페이스

### 단계별 출력 (Streaming)
- 사용자가 과정을 볼 수 있도록 단계별 메시지 표시:
  1. "입력하신 '타이백귤'을 분석 중입니다..."
  2. "품목 그룹을 찾고 있습니다... → '일반 감귤' 그룹으로 분류되었습니다."
  3. "유사 상품을 검색 중입니다... → 15개 상품을 찾았습니다."
  4. "가장 유사한 상품 3개를 선정 중입니다..."
  5. "첫 주 판매 데이터를 분석 중입니다..."
  6. "예측값을 산출 중입니다..."

### 최종 출력 포맷
```
[타이백귤 예측 결과]

▶ 품목 그룹: 일반 감귤

▶ 유사 상품 Top 3:
   1. 하우스감귤(800g/팩) - 규격과 포장이 유사
   2. H_Sweet 고당도 감귤(800g) - 프리미엄 감귤류
   3. 썬레드감귤(1kg) - 동일 감귤류

▶ 첫 주 판매 통계:
| 상품명 | 평균 | 최소 | 최대 | 표준편차 |
|--------|-----|-----|-----|---------|
| 하우스감귤 | 45 | 20 | 80 | 15.2 |
| H_Sweet 감귤 | 38 | 15 | 65 | 12.8 |
| 썬레드감귤 | 52 | 25 | 90 | 18.5 |

▶ 추천 발주량: 40~50개
  (근거: 유사 상품 첫 주 평균 45개 기준, 신상품 초기 보수적 접근 권장)
```

## 파일 구조
- `dashboard/components/chatbot_cold_start.py` - 메인 챗봇 로직
- `dashboard/app.py` - 버튼 추가 및 모달 호출

## 구현 순서
1. PRODUCT_GROUPS dict 정의
2. Supabase 검색 함수 구현
3. LLM 프롬프트 작성 (품목 그룹 추론, Top 3 선정, 예측값 산출)
4. 첫 주 통계 계산 함수 구현
5. 모달 UI 구현 (단계별 출력)
6. app.py에 버튼 추가
